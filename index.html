<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Loom Launcher ‚Äî —Ä–µ–ª–∏–∑</title>
<meta name="description" content="–†–µ–ª–∏–∑ Loom Launcher. –¢–∞–π–º–µ—Ä, —Å–∞–ª—é—Ç—ã, –ª–æ–∫–∞–ª—å–Ω—ã–π —Å—á—ë—Ç—á–∏–∫ —Å–∫–∞—á–∏–≤–∞–Ω–∏–π, –º—É–∑—ã–∫–∞ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è." />
<meta name="theme-color" content="#ff7a3d" />
<style>
  :root{
    --bg1:#0e0f13; --bg2:#131522;
    --card: rgba(18,19,26,.68);
    --border: rgba(255,255,255,.08);
    --muted:#a7abb4;
    --accent:#ff7a3d; --accent-2:#ffd39f; --good:#3ddc97;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:#fff; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background:
      radial-gradient(1200px 800px at 85% -10%, #262748 0%, transparent 50%),
      radial-gradient(900px 700px at -10% 95%, #242038 0%, transparent 55%),
      linear-gradient(160deg, var(--bg1), var(--bg2));
    overflow-x:hidden;
  }
  /* —Å–ø–æ–∫–æ–π–Ω—ã–µ ¬´–ø—è—Ç–Ω–∞¬ª –∏ —à—É–º */
  .blobs, .noise { position:fixed; inset:0; pointer-events:none; z-index:0; }
  .blobs{
    background:
      radial-gradient(600px 360px at 15% 20%, rgba(255,122,61,.20), transparent 60%),
      radial-gradient(520px 320px at 80% 25%, rgba(61,220,151,.12), transparent 60%),
      radial-gradient(640px 380px at 50% 95%, rgba(106,169,255,.10), transparent 60%);
    filter: blur(20px);
  }
  .noise{
    background-image: url('data:image/svg+xml;utf8,\
      <svg xmlns="http://www.w3.org/2000/svg" width="160" height="160">\
       <filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="2" stitchTiles="stitch"/></filter>\
       <rect width="100%" height="100%" filter="url(%23n)" opacity=".04"/>\
      </svg>');
    background-size: 260px 260px; mix-blend-mode: overlay;
  }

  main{ position:relative; z-index:1; min-height:100%; display:grid; place-items:center; padding:28px; }
  .card{
    width:min(1040px,100%);
    background: var(--card);
    backdrop-filter: blur(12px);
    border:1px solid var(--border);
    border-radius:22px; padding:28px;
    box-shadow: 0 10px 40px rgba(0,0,0,.35);
  }
  .brand{display:flex; gap:16px; align-items:center; margin-bottom:8px}
  .logo{
    width:60px; height:60px; border-radius:16px; display:grid; place-items:center;
    background: conic-gradient(from 210deg, #ff9e5f, #ff7a3d 40%, #e65100 70%, #ff9e5f);
    box-shadow: inset 0 2px 6px rgba(0,0,0,.25), 0 6px 18px rgba(255,122,61,.25);
  }
  .logo svg{filter: drop-shadow(0 2px 2px rgba(0,0,0,.25))}
  h1{margin:0; font-size:28px; line-height:1.2}
  .sub{color:var(--muted); margin:4px 0 0; font-size:14px}

  .row{display:flex; gap:24px; flex-wrap:wrap; margin-top:22px}
  .col{flex:1 1 360px}
  .block{
    background: rgba(255,255,255,.03);
    border:1px solid var(--border);
    border-radius:16px; padding:18px;
  }
  .label{color:var(--muted); font-size:12px; letter-spacing:.08em; text-transform:uppercase}
  .timer{display:flex; gap:10px; margin-top:12px; flex-wrap:wrap}
  .tbox{
    background: rgba(0,0,0,.22); border:1px solid rgba(255,255,255,.08);
    border-radius:12px; min-width:94px; padding:14px 12px; text-align:center
  }
  .num{font-size:30px; font-weight:800}
  .cap{font-size:12px; color:var(--muted)}
  .kpi{display:flex; align-items:center; gap:8px; margin-top:12px; color:var(--muted)}
  .dot{width:10px; height:10px; border-radius:50%; background:var(--good); box-shadow:0 0 12px var(--good)}

  .btns{display:flex; gap:12px; flex-wrap:wrap; margin-top:16px}
  .btn{
    padding:12px 18px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
    background:linear-gradient(180deg, rgba(255,122,61,.98), rgba(230,81,0,.98));
    color:#0c0c0c; font-weight:800; text-decoration:none; display:inline-flex; align-items:center; gap:10px;
    transform:translateY(0) scale(1); transition:transform .15s ease, box-shadow .15s ease, opacity .2s ease;
    box-shadow: 0 10px 26px rgba(255,122,61,.45); cursor:pointer; user-select:none;
  }
  .btn:hover{transform:translateY(-1px) scale(1.02)}
  .btn[disabled]{opacity:.55; pointer-events:none}
  .btn.secondary{
    background:transparent; color:#fff; border-color:rgba(255,255,255,.24); box-shadow:none;
  }
  .hint{color:var(--muted); font-size:12px; margin-top:8px}
  .sep{height:1px; background:rgba(255,255,255,.08); margin:18px 0}
  .foot{display:flex; justify-content:space-between; align-items:center; gap:12px; color:var(--muted); font-size:12px}
  code{background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1); padding:4px 6px; border-radius:8px}

  /* –∫–Ω–æ–ø–∫–∞-–≥–∏–≥–∞–Ω—Ç –ø—Ä–∏ —Ä–µ–ª–∏–∑–µ */
  .mega { position: fixed; inset:0; display:none; z-index:3;
    background: radial-gradient(1200px 800px at 50% -20%, rgba(255,143,92,.25), transparent 55%);
    align-items:center; justify-content:center; }
  .mega .btn {
    transform: scale(1.0);
    font-size: clamp(22px, 3vw, 36px);
    padding: 18px 28px; border-radius: 16px;
    box-shadow: 0 18px 50px rgba(255,122,61,.6);
    animation: bounce 0.9s ease-in-out infinite;
  }
  @keyframes bounce { 0%,100% { transform: translateY(0) scale(1.0); } 50% { transform: translateY(-8px) scale(1.04); } }

  /* —Ö–æ–ª—Å—Ç —Ñ–µ–π–µ—Ä–≤–µ—Ä–∫–æ–≤ */
  #fx { position: fixed; inset:0; z-index:2; pointer-events:none; display:none; }

  /* –º–æ–¥–∞–ª–∫–∞ */
  .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; z-index:4; }
  .modal{ position:fixed; inset:0; display:none; place-items:center; z-index:5; padding:24px; }
  .modal .box{
    width:min(980px,100%); max-height:85vh; overflow:auto;
    background:var(--card); border:1px solid var(--border); border-radius:16px; padding:22px;
    box-shadow:0 10px 40px rgba(0,0,0,.5);
  }
  .modal h2{margin:0 0 6px 0}
  .modal .muted{color:var(--muted)}
  .modal .actions{display:flex; justify-content:flex-end; gap:10px; margin-top:14px}
  .kbd{padding:2px 6px; border-radius:6px; border:1px solid rgba(255,255,255,.2); background:rgba(255,255,255,.08); font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}

  /* –ø–∞–Ω–µ–ª—å –º—É–∑—ã–∫–∏/–¥–∞—Ç—ã */
  .infobar{display:flex; align-items:center; gap:14px; flex-wrap:wrap; margin-top:12px; color:var(--muted); font-size:13px}
  .infobar button{padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.15); background:transparent; color:#fff; cursor:pointer}
  .infobar button:hover{background:rgba(255,255,255,.06)}
</style>
</head>
<body>
  <div class="blobs"></div><div class="noise"></div>

  <main>
    <section class="card">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <!-- –ª–æ–≥–æ-—à–ø—É–ª—è -->
          <svg width="32" height="32" viewBox="0 0 64 64" fill="none" aria-hidden="true">
            <path d="M12 8c0 0 12-8 24 0s12 32 0 40-24 0-24 0-4-20 0-40z" fill="#3b1600" opacity=".25"/>
            <path d="M14 10c0 0 11-7 22 0s11 28 0 35-22 0-22 0-4-18 0-35z" fill="#ff9e5f" stroke="#7a2a06" stroke-width="3" />
            <rect x="22" y="20" width="20" height="18" rx="4" fill="#7a2a06"/>
            <rect x="25" y="24" width="14" height="2" rx="1" fill="#ffcf9e"/>
            <rect x="25" y="28" width="14" height="2" rx="1" fill="#ffcf9e"/>
            <rect x="25" y="32" width="14" height="2" rx="1" fill="#ffcf9e"/>
            <circle cx="40" cy="18" r="2" fill="#7a2a06"/>
            <path d="M44 43c6 6 10 6 12 4" stroke="#7a2a06" stroke-width="3" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <h1>Loom Launcher ‚Äî —Ä–µ–ª–∏–∑</h1>
          <p class="sub">–¢—ë–ø–ª—ã–π, —É—é—Ç–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π –ª–∞—É–Ω—á–µ—Ä. –ö–Ω–æ–ø–∫–∞ ¬´–°–∫–∞—á–∞—Ç—å¬ª –ø–æ—è–≤–∏—Ç—Å—è —Ä–æ–≤–Ω–æ –≤ –º–æ–º–µ–Ω—Ç —Ä–µ–ª–∏–∑–∞.</p>
        </div>
      </div>

      <div class="row">
        <section class="col block">
          <div class="label">–î–æ —Ä–µ–ª–∏–∑–∞ –æ—Å—Ç–∞–ª–æ—Å—å</div>
          <div class="timer" id="timer">
            <div class="tbox"><div class="num" id="d">0</div><div class="cap">–¥–Ω–µ–π</div></div>
            <div class="tbox"><div class="num" id="h">00</div><div class="cap">—á–∞—Å–æ–≤</div></div>
            <div class="tbox"><div class="num" id="m">00</div><div class="cap">–º–∏–Ω—É—Ç</div></div>
            <div class="tbox"><div class="num" id="s">00</div><div class="cap">—Å–µ–∫—É–Ω–¥</div></div>
          </div>

          <div class="kpi"><span class="dot"></span> –°–∫–∞—á–∏–≤–∞–Ω–∏–π: <b id="dlCount">0 (–ª–æ–∫–∞–ª—å–Ω–æ)</b></div>

          <div class="btns">
            <a id="dl" class="btn" href="#" download disabled>‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å Loom Launcher</a>
            <button id="more" class="btn secondary" type="button">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
          </div>

          <div class="infobar">
            <button id="snd" type="button">üîä –í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É</button>
            <span id="when" class="muted"></span>
          </div>

          <div class="hint">–ö–Ω–æ–ø–∫–∞ —Å—Ç–∞–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –≤ –º–æ–º–µ–Ω—Ç –≤—ã—Ö–æ–¥–∞. –í—Ä–µ–º—è –±–µ—Ä—ë—Ç—Å—è –∏–∑ –≤–∞—à–µ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–æ–Ω—ã.</div>
        </section>

        <section class="col block">
          <div class="label">–û Loom Launcher</div>
          <p style="margin:10px 0 0; line-height:1.7;">
            Loom Launcher ‚Äî —ç—Ç–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –ª–∞—É–Ω—á–µ—Ä —Å –¥–æ–±—Ä–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π. –ú—ã –Ω–µ –≥–æ–Ω–∏–º—Å—è –∑–∞ –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–µ–π:
            –Ω–∞—à–∞ —Ü–µ–ª—å ‚Äî <b>—É—é—Ç</b>, –ø—Ä–æ—Å—Ç–æ—Ç–∞ –∏ —É–≤–∞–∂–µ–Ω–∏–µ –∫ –∏–≥—Ä–æ–∫—É –∏ –∏–Ω–¥–∏-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º. –õ–∞—É–Ω—á–µ—Ä –ª—ë–≥–∫–∏–π, –ø–æ–Ω—è—Ç–Ω—ã–π,
            –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–µ–º—ã –∏ —Å–∞–º —Å–µ–±—è –æ–±–Ω–æ–≤–ª—è–µ—Ç.
          </p>
          <ul style="margin:10px 0 0 18px; line-height:1.7;">
            <li>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º</li>
            <li>–ö–æ–Ω—Ç—Ä–æ–ª—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤ (SHA-256)</li>
            <li>–°–∞–º–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∞—É–Ω—á–µ—Ä–∞ —á–µ—Ä–µ–∑ GitHub Pages</li>
            <li>–¢–µ–º—ã, –∞–∫—Ü–µ–Ω—Ç–Ω—ã–µ —Ü–≤–µ—Ç–∞ –∏ ¬´—É—é—Ç–Ω–∞—è¬ª —ç—Å—Ç–µ—Ç–∏–∫–∞</li>
          </ul>
        </section>
      </div>

      <div class="sep"></div>
      <footer class="foot">
        <div>¬© <span id="yr"></span> Loom Launcher</div>
        <div>—Ç–µ–ª–µ–≥—Ä–∞–º –∫–∞–Ω–∞–ª:https://t.me/loomLauncher</div>
      </footer>
    </section>
  </main>

  <!-- —Ö–æ–ª—Å—Ç —Ñ–µ–π–µ—Ä–≤–µ—Ä–∫–æ–≤ -->
  <canvas id="fx"></canvas>
  <!-- –≥–∏–≥–∞–Ω—Ç—Å–∫–∞—è –∫–Ω–æ–ø–∫–∞ -->
  <div class="mega" id="mega"><a id="megaBtn" class="btn" href="#" download>‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å Loom Launcher</a></div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ ¬´–ü–æ–¥—Ä–æ–±–Ω–µ–µ¬ª -->
  <div class="modal-backdrop" id="mbg"></div>
  <div class="modal" id="modal">
    <div class="box">
      <h2>–ö–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Loom Launcher</h2>
      <p class="muted">–ï—Å–ª–∏ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å/SmartScreen –∂–∞–ª—É–µ—Ç—Å—è ‚Äî —ç—Ç–æ —Ç–∏–ø–∏—á–Ω–æ –¥–ª—è –Ω–æ–≤–æ–≥–æ .exe, –ø–æ–∫–∞ –æ–Ω ¬´–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω —Å–∏—Å—Ç–µ–º–µ¬ª.</p>
      <ol style="line-height:1.7;">
        <li>–ù–∞–∂–º–∏—Ç–µ ¬´–°–∫–∞—á–∞—Ç—å Loom Launcher¬ª –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª <b>LoomLauncher.exe</b>.</li>
        <li>–î–≤–∞–∂–¥—ã —â—ë–ª–∫–Ω–∏—Ç–µ –ø–æ —Ñ–∞–π–ª—É, —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å.</li>
        <li><b>SmartScreen</b> (—Å–∏–Ω–µ–µ –æ–∫–Ω–æ): –Ω–∞–∂–º–∏—Ç–µ <span class="kbd">More info</span> ‚Üí <span class="kbd">Run anyway</span>.</li>
        <li>–ï—Å–ª–∏ <b>Windows Defender</b> –ø–æ–º–µ—Å—Ç–∏–ª —Ñ–∞–π–ª –≤ –∫–∞—Ä–∞–Ω—Ç–∏–Ω:
          <ul>
            <li>–û—Ç–∫—Ä–æ–π—Ç–µ ¬´–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å Windows¬ª ‚Üí ¬´–ó–∞—â–∏—Ç–∞ –æ—Ç –≤–∏—Ä—É—Å–æ–≤ –∏ —É–≥—Ä–æ–∑¬ª ‚Üí ¬´–ñ—É—Ä–Ω–∞–ª –∑–∞—â–∏—Ç—ã¬ª.</li>
            <li>–ù–∞–π–¥–∏—Ç–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫—É LoomLauncher ‚Üí ¬´–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å¬ª ‚Üí ¬´–†–∞–∑—Ä–µ—à–∏—Ç—å –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ¬ª.</li>
            <li>–î–æ–±–∞–≤—å—Ç–µ –ø–∞–ø–∫—É –ª–∞—É–Ω—á–µ—Ä–∞ –≤ –∏—Å–∫–ª—é—á–µ–Ω–∏—è:
              ¬´–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞—â–∏—Ç—ã –æ—Ç –≤–∏—Ä—É—Å–æ–≤ –∏ —É–≥—Ä–æ–∑¬ª ‚Üí ¬´–ò—Å–∫–ª—é—á–µ–Ω–∏—è¬ª ‚Üí ¬´–î–æ–±–∞–≤–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ¬ª ‚Üí ¬´–ü–∞–ø–∫–∞¬ª ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –ø–∞–ø–∫—É —Å –ª–∞—É–Ω—á–µ—Ä–æ–º
              (–Ω–∞–ø—Ä–∏–º–µ—Ä, <span class="kbd">C:\dev\game-platform\launcher\dist</span>).</li>
          </ul>
        </li>
        <li>–†—è–¥–æ–º —Å .exe –ø–æ–ª–æ–∂–∏—Ç–µ —Ñ–∞–π–ª <span class="kbd">launcher_config.json</span>:
<pre style="background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); padding:10px; border-radius:10px; overflow:auto;">{
  "catalogUrl": "https://artemPGH.github.io/game-catalog/games.json",
  "updateUrl":  "https://artemPGH.github.io/game-catalog/update.json"
}</pre>
        </li>
        <li>–ì–æ—Ç–æ–≤–æ! –ó–∞–ø—É—Å–∫–∞–π—Ç–µ Loom Launcher –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ –∏–≥—Ä—ã.</li>
      </ol>

      <h3>–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–∞—É–Ω—á–µ—Ä–∞</h3>
      <p>–õ–∞—É–Ω—á–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç <span class="kbd">update.json</span> –∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –æ–±–Ω–æ–≤–∏—Ç—å—Å—è, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è.
      –ù–∞–∂–º–∏—Ç–µ ¬´–û–±–Ω–æ–≤–∏—Ç—å –ª–∞—É–Ω—á–µ—Ä¬ª –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.</p>

      <div class="actions">
        <button id="close" class="btn secondary" type="button">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

<script>
  // ======== –¢–í–û–ò –ö–û–ù–°–¢–ê–ù–¢–´ (—É–∂–µ –ø—Ä–æ—Å—Ç–∞–≤–ª–µ–Ω—ã) ========
  const TARGET_ISO   = "2025-10-11T17:00:00+01:00";
  const DOWNLOAD_URL = "https://artemPGH.github.io/game-catalog/Launcher/LoomLauncher.exe";

  // ======== –≠–õ–ï–ú–ï–ù–¢–´ ========
  const target = new Date(TARGET_ISO);
  const els = {
    d: document.getElementById('d'),
    h: document.getElementById('h'),
    m: document.getElementById('m'),
    s: document.getElementById('s'),
    dl: document.getElementById('dl'),
    dlCount: document.getElementById('dlCount'),
    mega: document.getElementById('mega'),
    megaBtn: document.getElementById('megaBtn'),
    fx: document.getElementById('fx'),
    when: document.getElementById('when'),
    yr: document.getElementById('yr'),
    more: document.getElementById('more'),
    modal: document.getElementById('modal'),
    mbg: document.getElementById('mbg'),
    close: document.getElementById('close'),
    snd: document.getElementById('snd')
  };
  els.when.textContent = "–†–µ–ª–∏–∑: " + target.toLocaleString();
  els.yr.textContent = new Date().getFullYear();

  // ======== –ú–£–ó–´–ö–ê (WebAudio) ‚Äî —Ç–∏—Ö–∏–π –ª—É–ø, –ø–æ –∫–Ω–æ–ø–∫–µ, —Å –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º ========
  let audioCtx, masterGain, seqTimer;
  function setupAudio(){
    if (audioCtx) return;
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    masterGain = audioCtx.createGain();
    masterGain.gain.value = 0.0; masterGain.connect(audioCtx.destination);
  }
  function playAmbient(){
    setupAudio();
    if (audioCtx.state === 'suspended') audioCtx.resume();
    const notes = [196, 247, 294, 392, 494, 587, 784]; // —Å–ø–æ–∫–æ–π–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
    let i = 0;
    masterGain.gain.linearRampToValueAtTime(0.035, audioCtx.currentTime + 0.2);
    stopAmbient();
    seqTimer = setInterval(()=>{
      const osc = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      osc.type = 'sine';
      osc.frequency.value = notes[i % notes.length] * (Math.random() < 0.2 ? 2 : 1);
      g.gain.setValueAtTime(0.0, audioCtx.currentTime);
      g.gain.linearRampToValueAtTime(0.05, audioCtx.currentTime + 0.08);
      g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.9);
      osc.connect(g); g.connect(masterGain);
      osc.start(); osc.stop(audioCtx.currentTime + 1.0);
      i++;
    }, 1000);
    localStorage.setItem("loom_sound", "on");
    els.snd.textContent = "üîá –í—ã–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É";
  }
  function stopAmbient(){
    if (seqTimer) clearInterval(seqTimer);
    if (masterGain) masterGain.gain.linearRampToValueAtTime(0.0, (audioCtx?.currentTime || 0) + 0.2);
    localStorage.setItem("loom_sound", "off");
    els.snd.textContent = "üîä –í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É";
  }
  els.snd.addEventListener('click', ()=>{
    if (!audioCtx || audioCtx.state !== 'running' || localStorage.getItem("loom_sound") !== "on"){
      playAmbient();
    } else {
      stopAmbient();
    }
  });
  // –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑—Ä–µ—à–∞–ª —Ä–∞–Ω–µ–µ ‚Äî –≤–∫–ª—é—á–∏–º –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–ª–∏–∫–µ –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
  if (localStorage.getItem("loom_sound") === "on"){
    window.addEventListener('pointerdown', function once(){
      playAmbient(); window.removeEventListener('pointerdown', once, {capture:true});
    }, {capture:true, once:true});
  }

  // ======== –§–ï–ô–ï–†–í–ï–†–ö–ò (canvas) ========
  const ctx = els.fx.getContext('2d');
  function resizeFX(){ els.fx.width = window.innerWidth; els.fx.height = window.innerHeight; }
  window.addEventListener('resize', resizeFX); resizeFX();
  const particles = [];
  function firework(x, y, color){
    const n = 60 + Math.floor(Math.random()*30);
    for (let i=0;i<n;i++){
      const angle = Math.random()*Math.PI*2;
      const speed = 2 + Math.random()*4;
      particles.push({ x, y, vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed - 1, life: 60 + Math.random()*30, color });
    }
  }
  let fxAnim, fxEndTime = 0;
  function startFireworks(durationMs=5000){
    els.fx.style.display = 'block';
    fxEndTime = performance.now() + durationMs;
    if (audioCtx) masterGain.gain.linearRampToValueAtTime(0.06, audioCtx.currentTime + 0.2);
    (function loop(){
      const now = performance.now();
      ctx.clearRect(0,0,els.fx.width, els.fx.height);
      if (Math.random() < 0.08){
        const x = 80 + Math.random()*(els.fx.width-160);
        const y = 80 + Math.random()*(els.fx.height*0.5);
        const palette = ['#ff7a3d','#ffd39f','#ff4d4d','#3ddc97','#6aa9ff','#ffe66d'];
        firework(x,y, palette[Math.floor(Math.random()*palette.length)]);
      }
      for (let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.x += p.vx; p.y += p.vy; p.vy += 0.03; p.life -= 1;
        ctx.globalCompositeOperation = 'lighter';
        ctx.fillStyle = p.color;
        ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI*2); ctx.fill();
        if (p.life <= 0) particles.splice(i,1);
      }
      if (now < fxEndTime){ fxAnim = requestAnimationFrame(loop); }
      else { cancelAnimationFrame(fxAnim); els.fx.style.display = 'none';
             if (audioCtx) masterGain.gain.linearRampToValueAtTime(0.035, audioCtx.currentTime + 0.2); }
    })();
  }

  // ======== –¢–ê–ô–ú–ï–† ========
  function openDownload(){
    els.dl.removeAttribute('disabled');
    els.dl.href = DOWNLOAD_URL;
    els.megaBtn.href = DOWNLOAD_URL;
  }
  function showMega(){ els.mega.style.display = 'flex'; setTimeout(()=>{ els.mega.style.display='none'; }, 5000); }
  function tick(){
    const now = new Date();
    const diff = target - now;
    if (diff <= 0){
      clearInterval(tmr);
      openDownload();
      startFireworks(5000);
      if (localStorage.getItem("loom_sound") === "on") playAmbient();
      showMega();
      els.d.textContent = 0; els.h.textContent = "00"; els.m.textContent = "00"; els.s.textContent = "00";
      return;
    }
    const sec = Math.floor(diff/1000) % 60;
    const min = Math.floor(diff/1000/60) % 60;
    const hr  = Math.floor(diff/1000/60/60) % 24;
    const day = Math.floor(diff/1000/60/60/24);
    els.d.textContent = day;
    els.h.textContent = String(hr).padStart(2,'0');
    els.m.textContent = String(min).padStart(2,'0');
    els.s.textContent = String(sec).padStart(2,'0');
  }
  if (Date.now() >= target.getTime()) { openDownload(); }
  const tmr = setInterval(tick, 1000); tick();

  // ======== –õ–û–ö–ê–õ–¨–ù–´–ô –°–ß–Å–¢–ß–ò–ö –°–ö–ê–ß–ò–í–ê–ù–ò–ô ========
  function loadLocalCount(){
    const n = Number(localStorage.getItem('loom_dl_local')||"0");
    els.dlCount.textContent = n.toLocaleString('ru-RU') + " (–ª–æ–∫–∞–ª—å–Ω–æ)";
  }
  function bumpLocalCounter(){
    const cur = Number(localStorage.getItem('loom_dl_local')||"0")+1;
    localStorage.setItem('loom_dl_local', String(cur));
    loadLocalCount();
  }
  loadLocalCount();
  els.dl.addEventListener('click', bumpLocalCounter);
  els.megaBtn.addEventListener('click', bumpLocalCounter);

  // ======== –ú–û–î–ê–õ–ö–ê ========
  function openModal(){ els.mbg.style.display='block'; els.modal.style.display='grid'; }
  function closeModal(){ els.modal.style.display='none'; els.mbg.style.display='none'; }
  els.more.addEventListener('click', openModal);
  els.close.addEventListener('click', closeModal);
  els.mbg.addEventListener('click', closeModal);
</script>
</body>
</html>
